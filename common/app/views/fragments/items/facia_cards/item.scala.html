@(card: layout.Card, modifierClasses: String, containerIndex: Int, isList: Boolean = false, colSpan: Int = 1)(implicit request: RequestHeader, config: model.Config)

@import common.LinkTo
@import model.{FaciaDisplayElement, InlineVideo, VideoPlayer, LiveBlog}
@import views.support.{GetClasses, RemoveOuterParaHtml, RenderClasses, SnapData, Video640, TrailCssClasses}
@import views.html.fragments.media.video
@import views.html.fragments.items.facia_cards.meta
@import views.html.fragments.items.elements.facia_cards._
@import views.html.fragments.items.elements.starRating

@defining((card.item, card.index)) { case (trail, index) =>

<li class="facia-slice__item u-faux-block-link l-row__item  l-row__item--span-@colSpan @if(isList){ l-list__item }@card.cssClasses">
    @defining((trail.visualTone, containerIndex == 0)) { case (tone, isFirstContainer) =>
        <div
            class="@GetClasses.forNewStyleItem(trail, isFirstContainer) @modifierClasses u-cf"
            @if(trail.isCommentable) {
                @trail.discussionId.map{ id =>
                data-discussion-id="@id"
                }
                data-discussion-closed="@trail.isClosedForComments"
                data-discussion-inline-upgrade="true"
            }
            data-link-name="trail | @{index + 1}"
            @SnapData(trail)>

            <div class="fc-item__container">
                @FaciaDisplayElement.fromTrail(trail) match {
                    case InlineVideo(videoElement, title, endSlatePath) => {
                        @defining(VideoPlayer(
                                videoElement,
                                Video640,
                                title,
                                autoPlay = false,
                                showControlsAtStart = false,
                                endSlatePath,
                                Some(false)
                        )) { player =>

                            @* TODO: This is a temporary HACK until Rob Berry can clean up. *@
                            @if(Seq("half", "three", "full", "mega-full").exists(size => modifierClasses.contains(size))) {
                                <div class="fc-item__media-wrapper fc-item__media-wrapper--has-icon u-faux-block-link__promote">
                                    <div class="fc-item__video-container">
                                    @video(player)
                                    </div>
                                </div>
                            } else {
                                @image(trail, inlineImage = containerIndex == 0 && index < 4)
                            }
                        }
                    }

                    case _ => {
                        @image(trail, inlineImage = containerIndex == 0 && index < 4)
                    }
                }

                <div class="@RenderClasses(Map(
                    ("fc-item__header", true),
                    ("fc-item__header--inline-video", FaciaDisplayElement.isVideo(trail) && trail.isBoosted)
                ))">
                    @title(trail, index, containerIndex)
                    @trail match { case content:model.Content => @starRating(content) }
                    @if(tone == "comment") {
                        @trail.byline.map { byLine =>
                            @trail match { case content:model.Content =>
                            <p class="fc-item__byline tone-colour">@ContributorLinks(Html(byLine), content.contributors)</p>
                            }
                        }
                    }
                </div>

                @if(tone == "comment") {
                    @if(trail.hasLargeContributorImage) {
                        @trail.contributors.headOption.map { profile =>
                            @profile.contributorLargeImagePath.map{ image =>
                                <div class="fc-item__avatar">
                                    <img src="@image" alt="@profile.name" class="fc-item__avatar__media" />
                                </div>
                            }
                        }
                    }
                }

                @trail match {
                    case liveBlog: LiveBlog if liveBlog.isLive => {
                        <div class="fc-item__latest-block-wrapper"><a @Html(LinkTo.getHrefWithRel(trail)) class="fc-item__latest-block js-live-blog-latest-block" data-article-id="@liveBlog.id"></a></div>
                    }

                    case _ => {}
                }

                @trail.trailText.map { text =>
                    <div class="fc-item__standfirst">@Html(text)</div>
                }

                @meta(trail)
            </div>
            <a @Html(LinkTo.getHrefWithRel(trail)) class="u-faux-block-link__overlay" data-link-name="article" tabindex="-1">@RemoveOuterParaHtml(trail.headline)</a>
        </div>
    }
</li>
}
